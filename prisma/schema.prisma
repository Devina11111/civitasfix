generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                Int       @id @default(autoincrement())
  email             String    @unique
  password          String
  name              String
  role              Role      @default(STUDENT)
  nim               String?
  nidn              String?
  isVerified        Boolean   @default(true)
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  
  reports           Report[]
  notifications     Notification[]
  
  @@map("users")
}

model Report {
  id                Int       @id @default(autoincrement())
  title             String
  description       String
  location          String
  imageUrl          String?
  category          Category  @default(FURNITURE)
  status            Status    @default(PENDING)
  priority          Priority  @default(MEDIUM)
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  
  // Repair information
  repairNotes       String?
  repairStatus      String?
  estimatedCost     Float?
  actualCost        Float?
  repairDate        DateTime?
  completedAt       DateTime?
  
  userId            Int
  user              User      @relation(fields: [userId], references: [id])
  
  notifications     Notification[]
  
  @@index([userId])
  @@index([status])
  @@map("reports")
}

model Notification {
  id                Int       @id @default(autoincrement())
  title             String
  message           String
  type              NotificationType @default(INFO)
  isRead            Boolean   @default(false)
  link              String?
  createdAt         DateTime  @default(now())
  
  userId            Int
  user              User      @relation(fields: [userId], references: [id])
  reportId          Int?
  report            Report?   @relation(fields: [reportId], references: [id])
  
  @@index([userId])
  @@index([isRead])
  @@map("notifications")
}

enum Role {
  STUDENT
  LECTURER
  ADMIN
}

enum Category {
  FURNITURE
  ELECTRONIC
  BUILDING
  SANITARY
  OTHER
}

enum Status {
  PENDING
  CONFIRMED
  IN_PROGRESS
  COMPLETED
  REJECTED
}

enum Priority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

enum NotificationType {
  INFO
  WARNING
  SUCCESS
  ERROR
}
